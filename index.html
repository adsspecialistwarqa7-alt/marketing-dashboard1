<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marketing OS</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  üî• FIREBASE SETUP
  Replace the values below with YOUR Firebase project config
  Steps: console.firebase.google.com ‚Üí New Project ‚Üí Web App ‚Üí Copy config
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, set, get, onValue, remove, update }
    from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  // ‚¨á‚¨á‚¨á ÿ∂ÿπ ŸáŸÜÿß ÿßŸÑŸÄ config ÿ®ÿ™ÿßÿπŸÉ ŸÖŸÜ Firebase ‚¨á‚¨á‚¨á
  const firebaseConfig = {
    apiKey:            "AIzaSyBLxSv2ash9WZIOIHxUJBY5wPqzcYxjXI0",
    authDomain:        "markting-dashboard-265a6.firebaseapp.com",
    databaseURL:       "https://markting-dashboard-265a6-default-rtdb.firebaseio.com",
    projectId:         "markting-dashboard-265a6",
    storageBucket:     "markting-dashboard-265a6.firebasestorage.app",
    messagingSenderId: "16281620903",
    appId:             "1:162816209037:web:957bbd69e65f963dbe72c4"
  };
  // ‚¨Ü‚¨Ü‚¨Ü ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚¨Ü‚¨Ü‚¨Ü


  const app = initializeApp(firebaseConfig);
  const db  = getDatabase(app);

  // Expose to window so rest of script can use
  window._db     = db;
  window._ref    = ref;
  window._set    = set;
  window._get    = get;
  window._onValue = onValue;
  window._remove = remove;
  window._update = update;
  window._dbReady = true;
  window.dispatchEvent(new Event('db-ready'));
</script>

<style>
:root{
  --bg:#0d0f14;--surface:#13161d;--surface2:#1a1e28;--border:#252a38;
  --social:#3b82f6;--media:#f97316;--seo:#10b981;
  --copy:#a855f7;--motion:#ec4899;--design:#06b6d4;
  --text:#e2e8f0;--muted:#64748b;
  --done:#10b981;--hold:#f59e0b;--pending:#ef4444;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100vh;}

.page{display:none;padding:28px;}
.page.active{display:block;}

/* HEADER */
.top-bar{display:flex;align-items:center;justify-content:space-between;margin-bottom:32px;padding-bottom:18px;border-bottom:1px solid var(--border);}
.logo{font-family:'Syne',sans-serif;font-size:22px;font-weight:800;}
.logo span{color:var(--social);}
.back-btn{display:inline-flex;align-items:center;gap:7px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:8px 16px;font-size:13px;font-weight:600;cursor:pointer;color:var(--text);transition:all .2s;}
.back-btn:hover{border-color:var(--social);color:var(--social);}

/* SYNC BADGE */
.sync-badge{display:inline-flex;align-items:center;gap:5px;font-size:11px;padding:5px 10px;border-radius:8px;font-weight:600;}
.sync-badge.live{background:rgba(16,185,129,.12);color:#34d399;}
.sync-badge.saving{background:rgba(245,158,11,.12);color:#fbbf24;}
.sync-badge.offline{background:rgba(239,68,68,.12);color:#f87171;}
.pulse{width:7px;height:7px;border-radius:50%;background:currentColor;animation:pulse 1.5s infinite;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}

/* SETUP BANNER */
.setup-banner{background:rgba(245,158,11,.08);border:1px solid rgba(245,158,11,.25);border-radius:14px;padding:20px 24px;margin-bottom:24px;display:none;}
.setup-banner.show{display:block;}
.setup-banner h3{font-family:'Syne',sans-serif;font-size:15px;font-weight:800;color:#fbbf24;margin-bottom:8px;}
.setup-banner p{font-size:12px;color:var(--muted);line-height:1.7;}
.setup-banner a{color:var(--social);text-decoration:none;}
.setup-banner code{background:var(--surface2);padding:2px 6px;border-radius:4px;font-size:11px;}

/* HOME GRID */
.home-grid{display:grid;grid-template-columns:1fr;gap:20px;}
.panel{background:var(--surface);border:1px solid var(--border);border-radius:18px;overflow:hidden;}
.panel-header{display:flex;align-items:center;justify-content:space-between;padding:18px 22px;border-bottom:1px solid var(--border);}
.panel-title{font-family:'Syne',sans-serif;font-size:16px;font-weight:800;}
.btn-add{display:inline-flex;align-items:center;gap:6px;background:var(--social);color:#fff;border:none;border-radius:9px;padding:7px 14px;font-size:12px;font-weight:700;cursor:pointer;transition:opacity .2s;}
.btn-add:hover{opacity:.85;}

/* CLIENTS */
.clients-body{padding:16px;display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:12px;min-height:120px;}
.client-card{background:var(--surface2);border:1px solid var(--border);border-radius:13px;padding:16px 14px;cursor:pointer;transition:all .25s;position:relative;}
.client-card:hover{border-color:var(--social);transform:translateY(-2px);box-shadow:0 6px 24px rgba(59,130,246,.18);}
.client-avatar{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:16px;font-weight:800;color:#fff;margin-bottom:10px;}
.client-name{font-family:'Syne',sans-serif;font-size:13px;font-weight:700;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.client-date{font-size:10px;color:var(--muted);}
.client-prog{margin-top:8px;height:4px;background:var(--border);border-radius:4px;overflow:hidden;}
.client-prog-fill{height:100%;border-radius:4px;}
.client-del{position:absolute;top:8px;right:8px;width:20px;height:20px;border-radius:50%;background:rgba(239,68,68,.15);color:#f87171;border:none;cursor:pointer;font-size:11px;display:none;align-items:center;justify-content:center;}
.client-card:hover .client-del{display:flex;}
.empty-hint{color:var(--muted);font-size:12px;padding:24px;text-align:center;grid-column:1/-1;}
.loading-hint{color:var(--muted);font-size:12px;padding:24px;text-align:center;grid-column:1/-1;animation:pulse 1.2s infinite;}

/* TASKS TABS */
.tasks-tabs{display:flex;border-bottom:1px solid var(--border);}
.tasks-tab{flex:1;padding:12px;text-align:center;font-size:12px;font-weight:700;cursor:pointer;border-bottom:2px solid transparent;color:var(--muted);transition:all .2s;}
.tasks-tab.active{color:var(--text);border-bottom-color:var(--social);}
.tasks-tab[data-tab="copy"].active{border-bottom-color:var(--copy);color:var(--copy);}
.tasks-tab[data-tab="motion"].active{border-bottom-color:var(--motion);color:var(--motion);}
.tasks-tab[data-tab="design"].active{border-bottom-color:var(--design);color:var(--design);}
.tasks-body{padding:0;}
.tab-content{display:none;}
.tab-content.active{display:block;}
/* COPY SPREADSHEET */
.copy-toolbar{display:flex;align-items:center;gap:8px;padding:10px 14px;border-bottom:1px solid var(--border);flex-wrap:wrap;background:var(--surface2);}
.copy-toolbar select,.copy-toolbar input{background:var(--surface);border:1px solid var(--border);border-radius:7px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:11px;padding:5px 8px;outline:none;}
.copy-toolbar input[type="date"]{font-size:10px;}
.copy-toolbar select:focus,.copy-toolbar input:focus{border-color:var(--copy);}
.btn-add-row{background:var(--copy);color:#fff;border:none;border-radius:7px;padding:6px 14px;font-size:12px;font-weight:700;cursor:pointer;white-space:nowrap;}
.btn-add-row:hover{opacity:.85;}
.copy-stats{margin-left:auto;display:flex;gap:8px;font-size:10px;align-items:center;}
.stat-pill{padding:3px 9px;border-radius:8px;font-weight:700;}
.stat-done{background:rgba(16,185,129,.15);color:#34d399;}
.stat-pending{background:rgba(100,116,139,.12);color:#94a3b8;}
.stat-kpi{background:rgba(168,85,247,.15);color:#c084fc;}
.copy-table-wrap{overflow-x:auto;max-height:460px;overflow-y:auto;}
.copy-table{width:100%;border-collapse:collapse;font-size:11px;min-width:900px;}
.copy-table thead{position:sticky;top:0;z-index:10;}
.copy-table thead th{padding:7px 8px;text-align:left;font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--muted);background:#111318;border-bottom:2px solid var(--border);white-space:nowrap;}
.copy-table tbody tr{transition:background .25s;}
.copy-table tbody tr:hover{background:rgba(168,85,247,.04);}
.copy-table tbody tr.row-done{background:rgba(16,185,129,.07);}
.copy-table tbody tr.row-done td .ct-inp,.copy-table tbody tr.row-done td .ct-num{color:#34d399;}
.copy-table tbody tr.row-overdue:not(.row-done){background:rgba(239,68,68,.05);}
.copy-table tbody td{padding:5px 7px;border-bottom:1px solid var(--border);vertical-align:middle;}
.ct-sel{background:var(--surface2);border:1px solid transparent;border-radius:5px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:10px;padding:3px 5px;width:100%;outline:none;cursor:pointer;}
.ct-sel:focus{border-color:var(--copy);}
.ct-inp{background:transparent;border:none;border-bottom:1px dashed transparent;color:var(--text);font-family:'DM Sans',sans-serif;font-size:10px;padding:2px 3px;width:100%;outline:none;min-width:55px;}
.ct-inp:focus{border-bottom-color:var(--copy);}
.ct-date{background:var(--surface2);border:1px solid transparent;border-radius:5px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:9px;padding:3px 4px;width:100%;outline:none;}
.ct-date:focus{border-color:var(--copy);}
.ct-num{background:transparent;border:none;border-bottom:1px dashed transparent;color:var(--text);font-family:'DM Sans',sans-serif;font-size:10px;padding:2px;width:44px;outline:none;text-align:center;}
.ct-num:focus{border-bottom-color:var(--copy);}
.ct-kpi{font-family:'Syne',sans-serif;font-size:11px;font-weight:800;color:var(--copy);text-align:center;min-width:36px;display:block;}
.ct-factor{font-size:10px;color:var(--muted);text-align:center;}
.ct-chk{width:18px;height:18px;border-radius:5px;border:2px solid var(--border);background:transparent;cursor:pointer;appearance:none;position:relative;transition:all .2s;display:block;margin:0 auto;}
.ct-chk:checked{background:var(--done);border-color:var(--done);}
.ct-chk:checked::after{content:'‚úì';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:10px;font-weight:800;}
.ct-chk.agree{border-color:#3b82f6;}
.ct-chk.agree:checked{background:var(--social);border-color:var(--social);}
.ct-rm{background:none;border:none;color:var(--muted);cursor:pointer;font-size:11px;opacity:.3;transition:opacity .2s;display:block;margin:0 auto;}
.ct-rm:hover{color:var(--pending);opacity:1;}
.media-badge{display:inline-block;font-size:9px;padding:2px 7px;border-radius:8px;font-weight:700;white-space:nowrap;}
.media-s{background:rgba(59,130,246,.15);color:#60a5fa;}
.media-m{background:rgba(249,115,22,.15);color:#fb923c;}
/* SIMPLE TASK LIST (Motion/Design) */
.task-input-row{display:flex;gap:8px;padding:12px 14px;}
.task-input-row input{flex:1;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:12px;padding:8px 12px;outline:none;}
.task-input-row input:focus{border-color:var(--social);}
.task-input-row select{background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);padding:0 8px;font-size:11px;outline:none;}
.task-list{display:flex;flex-direction:column;gap:6px;max-height:340px;overflow-y:auto;padding:0 14px 14px;}
.task-item{display:flex;align-items:center;gap:8px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:8px 12px;transition:background .2s;}
.task-item.done-item{background:rgba(16,185,129,.07);border-color:rgba(16,185,129,.2);}
.task-chk{width:18px;height:18px;border-radius:5px;border:2px solid var(--border);background:transparent;cursor:pointer;appearance:none;position:relative;flex-shrink:0;transition:all .2s;}
.task-chk:checked{background:var(--done);border-color:var(--done);}
.task-chk:checked::after{content:'‚úì';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:10px;font-weight:800;}
.task-text{flex:1;font-size:12px;}
.task-text.done-text{text-decoration:line-through;color:var(--muted);}
.task-rm{background:none;border:none;color:var(--muted);cursor:pointer;font-size:13px;padding:0 2px;}
.task-rm:hover{color:var(--pending);}
.task-priority{font-size:9px;padding:2px 6px;border-radius:10px;font-weight:700;}
.pri-high{background:rgba(239,68,68,.15);color:#f87171;}
.pri-med{background:rgba(245,158,11,.15);color:#fbbf24;}
.pri-low{background:rgba(100,116,139,.15);color:#94a3b8;}

/* MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:100;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .3s;}
.modal-overlay.open{opacity:1;pointer-events:all;}
.modal{background:var(--surface);border:1px solid var(--border);border-radius:18px;padding:28px;width:380px;transform:translateY(20px);transition:transform .3s;}
.modal-overlay.open .modal{transform:translateY(0);}
.modal h3{font-family:'Syne',sans-serif;font-size:18px;font-weight:800;margin-bottom:20px;}
.modal label{font-size:11px;color:var(--muted);display:block;margin-bottom:5px;margin-top:12px;}
.modal input,.modal select{width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:9px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;padding:10px 14px;outline:none;}
.modal input:focus{border-color:var(--social);}
.modal-actions{display:flex;gap:10px;margin-top:22px;}
.btn-confirm{flex:1;background:var(--social);color:#fff;border:none;border-radius:10px;padding:11px;font-family:'Syne',sans-serif;font-size:14px;font-weight:700;cursor:pointer;}
.btn-cancel{background:var(--surface2);color:var(--muted);border:1px solid var(--border);border-radius:10px;padding:11px 18px;font-family:'Syne',sans-serif;font-size:14px;font-weight:700;cursor:pointer;}

/* DASHBOARD */
.client-banner{display:flex;align-items:center;gap:14px;margin-bottom:20px;padding:16px 20px;background:var(--surface);border:1px solid var(--border);border-radius:14px;}
.client-banner .av{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:18px;font-weight:800;color:#fff;flex-shrink:0;}
.client-banner .info h2{font-family:'Syne',sans-serif;font-size:18px;font-weight:800;}
.client-banner .info p{font-size:11px;color:var(--muted);margin-top:2px;}
.banner-right{margin-left:auto;display:flex;align-items:center;gap:10px;}

.dates-row{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px;}
.date-card{background:var(--surface);border:1px solid var(--border);border-radius:13px;padding:14px 16px;position:relative;overflow:hidden;}
.date-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;}
.date-card.c-con::before{background:#8b5cf6;}
.date-card.c-sm::before{background:var(--social);}
.date-card.c-mb::before{background:var(--media);}
.date-card.c-seo::before{background:var(--seo);}
.card-label{font-size:9px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin-bottom:6px;}
.card-name-input{font-family:'Syne',sans-serif;font-size:13px;font-weight:700;background:transparent;border:none;outline:none;color:var(--text);width:100%;margin-bottom:8px;border-bottom:1px dashed var(--border);padding-bottom:3px;}
.date-fields{display:grid;grid-template-columns:1fr 1fr;gap:5px;margin-bottom:8px;}
.date-field label{font-size:9px;color:var(--muted);display:block;margin-bottom:2px;}
.date-field input[type="date"]{background:var(--surface2);border:1px solid var(--border);border-radius:5px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:10px;padding:3px 5px;width:100%;outline:none;}
.days-display{font-family:'Syne',sans-serif;font-size:20px;font-weight:800;}
.days-display.neg{color:var(--pending);}
.days-display.pos{color:var(--done);}
.days-sub{font-size:9px;color:var(--muted);}

.overall-row{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px;}
.overall-card{background:var(--surface);border:1px solid var(--border);border-radius:13px;padding:14px 18px;}
.overall-top{display:flex;justify-content:space-between;margin-bottom:7px;}
.overall-name{font-family:'Syne',sans-serif;font-size:12px;font-weight:700;}
.overall-pct{font-family:'Syne',sans-serif;font-size:20px;font-weight:800;}
.overall-bar{height:6px;background:var(--surface2);border-radius:6px;overflow:hidden;}
.overall-fill{height:100%;border-radius:6px;transition:width 1s ease;}

.section-card{background:var(--surface);border:1px solid var(--border);border-radius:15px;margin-bottom:16px;overflow:hidden;}
.section-header{display:flex;align-items:center;gap:9px;padding:13px 20px;border-bottom:1px solid var(--border);}
.section-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
.section-title{font-family:'Syne',sans-serif;font-size:15px;font-weight:700;}
.task-table{width:100%;overflow-x:auto;}
table{width:100%;border-collapse:collapse;font-size:11px;}
thead th{padding:8px 9px;text-align:center;font-size:9px;font-weight:600;text-transform:uppercase;letter-spacing:.6px;color:var(--muted);border-bottom:1px solid var(--border);white-space:nowrap;background:var(--surface2);}
thead th:first-child{text-align:left;min-width:65px;}
tbody td{padding:8px 9px;border-bottom:1px solid var(--border);vertical-align:middle;text-align:center;}
tbody td:first-child{text-align:left;font-weight:600;font-size:10px;color:var(--muted);white-space:nowrap;}
tbody tr:last-child td{border-bottom:none;}
.status-sel{padding:3px 7px;border-radius:18px;font-size:9px;font-weight:700;border:none;outline:none;cursor:pointer;font-family:'DM Sans',sans-serif;appearance:none;text-align:center;width:76px;}
.status-sel.done{background:rgba(16,185,129,.18);color:#34d399;}
.status-sel.hold{background:rgba(245,158,11,.18);color:#fbbf24;}
.status-sel.pending{background:rgba(100,116,139,.15);color:#94a3b8;}
.dl-input{background:var(--surface2);border:1px solid var(--border);border-radius:5px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:9px;padding:3px 4px;width:100%;min-width:85px;outline:none;text-align:center;}
.prog-wrap{display:flex;align-items:center;gap:7px;}
.prog-bar{flex:1;height:4px;background:var(--surface2);border-radius:4px;overflow:hidden;}
.prog-fill{height:100%;border-radius:4px;transition:width 1s ease;}
.prog-label{font-size:10px;font-weight:700;width:28px;}
.report-check{display:flex;flex-direction:column;align-items:center;gap:2px;}
.report-check label{font-size:8px;color:var(--muted);}
.chk{width:20px;height:20px;border-radius:5px;border:2px solid var(--border);background:var(--surface2);cursor:pointer;appearance:none;position:relative;transition:all .2s;}
.chk:checked{background:var(--done);border-color:var(--done);}
.chk:checked::after{content:'‚úì';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:10px;font-weight:800;}
.inline-input{background:transparent;border:none;outline:none;color:var(--text);font-family:'DM Sans',sans-serif;font-size:10px;width:100%;border-bottom:1px dashed var(--border);padding:2px 0;}
.inline-input:focus{border-bottom-color:var(--social);}
.inline-input::placeholder{color:var(--muted);}

.charts-section{margin-top:20px;}
.charts-section h2{font-family:'Syne',sans-serif;font-size:16px;font-weight:800;margin-bottom:14px;}
.charts-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:12px;}
.charts-grid-2{display:grid;grid-template-columns:2fr 1fr;gap:12px;}
.chart-card{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:14px;}
.chart-title{font-family:'Syne',sans-serif;font-size:12px;font-weight:700;margin-bottom:10px;display:flex;align-items:center;gap:6px;}
.chart-title .dot{width:6px;height:6px;border-radius:50%;flex-shrink:0;}
.chart-wrap{position:relative;height:170px;}
.chart-wrap-tall{position:relative;height:220px;}

.export-section{margin-top:24px;padding-top:20px;border-top:1px solid var(--border);display:flex;justify-content:center;gap:10px;}
.btn-export{display:inline-flex;align-items:center;gap:7px;background:linear-gradient(135deg,#3b82f6,#8b5cf6);color:#fff;border:none;border-radius:11px;padding:12px 28px;font-family:'Syne',sans-serif;font-size:14px;font-weight:700;cursor:pointer;box-shadow:0 4px 18px rgba(59,130,246,.3);transition:transform .2s,box-shadow .2s;}
.btn-export:hover{transform:translateY(-2px);}
.btn-rst{display:inline-flex;align-items:center;gap:7px;background:rgba(239,68,68,.12);color:#f87171;border:1px solid rgba(239,68,68,.25);border-radius:11px;padding:12px 20px;font-family:'Syne',sans-serif;font-size:13px;font-weight:700;cursor:pointer;}

@media print{.back-btn,.export-section,.setup-banner,.sync-badge{display:none!important;}body{background:#fff!important;color:#000!important;}}
.fade-in{animation:fadeUp .4s ease both;}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
@media(max-width:900px){.home-grid,.dates-row,.overall-row,.charts-grid,.charts-grid-2{grid-template-columns:1fr;}}
::-webkit-scrollbar{width:5px;height:5px;}
::-webkit-scrollbar-track{background:var(--surface2);}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px;}








/* ‚îÄ‚îÄ TOP BAR ‚îÄ‚îÄ */
.top-bar{display:flex;align-items:center;justify-content:space-between;margin-bottom:28px;padding-bottom:16px;border-bottom:1px solid var(--border);}
.logo{font-family:'Syne',sans-serif;font-size:22px;font-weight:800;}
.logo span{color:var(--social);}
.top-actions{display:flex;gap:10px;align-items:center;}
.save-dot{font-size:11px;color:var(--done);opacity:0;transition:opacity .4s;}
.save-dot.show{opacity:1;}

/* ‚îÄ‚îÄ SUMMARY CARDS ‚îÄ‚îÄ */
.summary-row{display:grid;grid-template-columns:repeat(6,1fr);gap:12px;margin-bottom:24px;}
.sum-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:14px 16px;position:relative;overflow:hidden;}
.sum-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;}
.sum-card.c-total::before{background:var(--muted);}
.sum-card.c-done::before{background:var(--done);}
.sum-card.c-new::before{background:var(--new);}
.sum-card.c-upsell::before{background:var(--copy);}
.sum-card.c-hold::before{background:var(--hold);}
.sum-card.c-lost::before{background:var(--lost);}
.sum-label{font-size:10px;text-transform:uppercase;letter-spacing:.8px;color:var(--muted);margin-bottom:4px;}
.sum-val{font-family:'Syne',sans-serif;font-size:26px;font-weight:800;}
.sum-sub{font-size:10px;color:var(--muted);margin-top:3px;}

/* ‚îÄ‚îÄ PANELS ‚îÄ‚îÄ */
.panel{background:var(--surface);border:1px solid var(--border);border-radius:16px;margin-bottom:20px;overflow:hidden;}
.panel-header{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;border-bottom:1px solid var(--border);background:var(--surface2);}
.panel-title{font-family:'Syne',sans-serif;font-size:15px;font-weight:800;display:flex;align-items:center;gap:8px;}
.panel-actions{display:flex;gap:8px;align-items:center;}

/* ‚îÄ‚îÄ TOOLBAR ‚îÄ‚îÄ */
.toolbar{display:flex;align-items:center;gap:8px;padding:10px 16px;border-bottom:1px solid var(--border);flex-wrap:wrap;}
.toolbar input,.toolbar select{background:var(--surface2);border:1px solid var(--border);border-radius:7px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:11px;padding:6px 10px;outline:none;}
.toolbar input:focus,.toolbar select:focus{border-color:var(--social);}
.toolbar input[type="date"]{font-size:10px;}
.filter-grp{display:flex;gap:6px;margin-left:auto;}
.filter-btn{padding:5px 12px;border-radius:7px;font-size:10px;font-weight:700;border:1px solid var(--border);background:transparent;color:var(--muted);cursor:pointer;transition:all .2s;}
.filter-btn.active{background:var(--surface2);color:var(--text);border-color:var(--muted);}
.filter-btn.f-new.active{border-color:var(--new);color:var(--new);}
.filter-btn.f-renewed.active{border-color:var(--renewed);color:var(--renewed);}
.filter-btn.f-hold.active{border-color:var(--hold);color:var(--hold);}
.filter-btn.f-lost.active{border-color:var(--lost);color:var(--lost);}

.btn{display:inline-flex;align-items:center;gap:6px;border:none;border-radius:8px;padding:7px 14px;font-family:'Syne',sans-serif;font-size:12px;font-weight:700;cursor:pointer;transition:all .2s;}
.btn-primary{background:var(--social);color:#fff;}
.btn-primary:hover{opacity:.85;}
.btn-danger{background:rgba(239,68,68,.12);color:#f87171;border:1px solid rgba(239,68,68,.25);}
.btn-danger:hover{background:rgba(239,68,68,.22);}
.btn-sm{padding:5px 10px;font-size:11px;}

/* ‚îÄ‚îÄ MAIN TABLE ‚îÄ‚îÄ */
.table-wrap{overflow-x:auto;}
.main-table{width:100%;border-collapse:collapse;font-size:11px;min-width:950px;}
.main-table thead th{padding:9px 10px;text-align:left;font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:var(--muted);background:#0f1117;border-bottom:2px solid var(--border);white-space:nowrap;position:sticky;top:0;z-index:5;}
.main-table tbody tr{transition:background .2s;}
.main-table tbody tr:hover{background:rgba(255,255,255,.025);}
.main-table tbody td{padding:7px 10px;border-bottom:1px solid var(--border);vertical-align:middle;}

/* Row status colors */
.row-new{border-left:3px solid var(--new)!important;}
.row-renewed{border-left:3px solid var(--renewed)!important;}
.row-hold{border-left:3px solid var(--hold)!important;}
.row-lost{border-left:3px solid var(--lost)!important;opacity:.6;}
.row-lost td{color:var(--muted);}

/* Status badge */
.status-badge{display:inline-block;padding:3px 9px;border-radius:10px;font-size:9px;font-weight:700;white-space:nowrap;}
.s-new{background:rgba(59,130,246,.15);color:#60a5fa;}
.s-renewed{background:rgba(168,85,247,.15);color:#c084fc;}
.s-hold{background:rgba(245,158,11,.15);color:#fbbf24;}
.s-lost{background:rgba(239,68,68,.15);color:#f87171;}
.s-other{background:rgba(100,116,139,.12);color:#94a3b8;}

/* Package badge */
.pkg-badge{display:inline-block;padding:2px 7px;border-radius:8px;font-size:9px;font-weight:700;}
.pkg-full{background:rgba(16,185,129,.15);color:#34d399;}
.pkg-ads{background:rgba(249,115,22,.15);color:#fb923c;}
.pkg-social{background:rgba(59,130,246,.15);color:#60a5fa;}
.pkg-seo{background:rgba(16,185,129,.12);color:#6ee7b7;}

/* Days remaining */
.days-ok{color:var(--done);font-weight:700;}
.days-warn{color:var(--hold);font-weight:700;}
.days-over{color:var(--lost);font-weight:700;}

/* Inputs inside table */
.t-inp{background:transparent;border:none;border-bottom:1px dashed transparent;color:var(--text);font-family:'DM Sans',sans-serif;font-size:11px;padding:2px 3px;width:100%;outline:none;min-width:80px;}
.t-inp:focus{border-bottom-color:var(--social);}
.t-sel{background:var(--surface2);border:1px solid transparent;border-radius:5px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:10px;padding:3px 6px;outline:none;cursor:pointer;width:100%;}
.t-sel:focus{border-color:var(--social);}
.t-date{background:var(--surface2);border:1px solid transparent;border-radius:5px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:10px;padding:3px 5px;width:130px;outline:none;}
.t-date:focus{border-color:var(--social);}
.t-chk{width:17px;height:17px;border-radius:5px;border:2px solid var(--border);background:transparent;cursor:pointer;appearance:none;position:relative;transition:all .2s;display:block;margin:0 auto;}
.t-chk:checked{background:var(--done);border-color:var(--done);}
.t-chk:checked::after{content:'‚úì';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:9px;font-weight:800;}
.t-chk.upsell-chk:checked{background:var(--copy);border-color:var(--copy);}
.t-rm{background:none;border:none;color:var(--muted);cursor:pointer;font-size:11px;opacity:.3;transition:opacity .2s;display:block;margin:0 auto;padding:0 4px;}
.t-rm:hover{color:var(--lost);opacity:1;}

/* ‚îÄ‚îÄ STATS SECTION ‚îÄ‚îÄ */
.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px;}
.stats-table{width:100%;border-collapse:collapse;font-size:11px;}
.stats-table thead th{padding:8px 12px;text-align:left;font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--muted);background:#0f1117;border-bottom:2px solid var(--border);}
.stats-table tbody td{padding:8px 12px;border-bottom:1px solid var(--border);font-size:11px;}
.stats-table tbody tr:last-child td{border-bottom:none;}
.stats-table .member-name{font-weight:600;}
.stats-table .pct-bar{display:flex;align-items:center;gap:6px;}
.stats-table .pct-fill{height:4px;border-radius:4px;background:var(--social);transition:width .6s;}
.stats-table .pct-txt{font-size:10px;color:var(--muted);white-space:nowrap;}

/* Overall stats box */
.overall-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:16px 20px;}
.ov-item{text-align:center;padding:12px;background:var(--surface2);border-radius:10px;}
.ov-label{font-size:9px;text-transform:uppercase;letter-spacing:.7px;color:var(--muted);margin-bottom:6px;}
.ov-val{font-family:'Syne',sans-serif;font-size:22px;font-weight:800;}
.ov-sub{font-size:9px;color:var(--muted);margin-top:3px;}

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:100;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .25s;}
.modal-overlay.open{opacity:1;pointer-events:all;}
.modal{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:26px;width:460px;max-width:95vw;transform:translateY(16px);transition:transform .25s;}
.modal-overlay.open .modal{transform:translateY(0);}
.modal h3{font-family:'Syne',sans-serif;font-size:17px;font-weight:800;margin-bottom:18px;}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.form-group{display:flex;flex-direction:column;gap:5px;}
.form-group.full{grid-column:1/-1;}
.form-group label{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;}
.form-group input,.form-group select{background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:12px;padding:9px 12px;outline:none;}
.form-group input:focus,.form-group select:focus{border-color:var(--social);}
.modal-actions{display:flex;gap:10px;margin-top:20px;}
.btn-confirm{flex:1;background:var(--social);color:#fff;border:none;border-radius:9px;padding:11px;font-family:'Syne',sans-serif;font-size:14px;font-weight:700;cursor:pointer;}
.btn-cancel{background:var(--surface2);color:var(--muted);border:1px solid var(--border);border-radius:9px;padding:11px 16px;font-family:'Syne',sans-serif;font-size:13px;font-weight:700;cursor:pointer;}

.fade-in{animation:fadeUp .4s ease both;}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
@media(max-width:800px){.summary-row{grid-template-columns:repeat(3,1fr);}.stats-grid{grid-template-columns:1fr;}}

.nav-crm-btn{display:inline-flex;align-items:center;gap:6px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:7px 14px;font-size:13px;font-weight:700;cursor:pointer;color:var(--text);transition:all .2s;font-family:'Syne',sans-serif;}
.nav-crm-btn:hover,.nav-crm-btn.active{border-color:var(--copy);color:var(--copy);}

</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- HOME PAGE -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="page-home" class="page active">
  <div class="top-bar fade-in">
    <div class="logo">Marketing <span>OS</span></div>
    <button class="nav-crm-btn" onclick="showPage('page-crm');this.classList.add('active')">üìä CRM</button>
    <div style="display:flex;align-items:center;gap:10px;">
      <div class="sync-badge offline" id="db-status"><div class="pulse"></div> Connecting...</div>
      <div style="font-size:11px;color:var(--muted)" id="home-date"></div>
    </div>
  </div>

  <!-- Setup banner - shows when Firebase not configured -->
  <div class="setup-banner" id="setup-banner">
    <h3>‚öôÔ∏è Firebase Setup Required</h3>
    <p>
      ŸÑÿßÿ≤ŸÖ ÿ™ÿ∂ÿ®ÿ∑ Firebase ÿπÿ¥ÿßŸÜ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ™ÿ™ÿ≤ÿßŸÖŸÜ ÿπŸÑŸâ ŸÉŸÑ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ÿßÿ™:<br/><br/>
      1Ô∏è‚É£ ÿ±Ÿàÿ≠ ÿπŸÑŸâ <a href="https://console.firebase.google.com" target="_blank">console.firebase.google.com</a><br/>
      2Ô∏è‚É£ ÿßÿπŸÖŸÑ <strong>New Project</strong> ‚Üí ÿßÿ≥ŸÖŸá ÿßŸä ÿ≠ÿßÿ¨ÿ©<br/>
      3Ô∏è‚É£ ÿßÿ∂ÿ∫ÿ∑ <strong>Web App</strong> (ÿ£ŸäŸÇŸàŸÜÿ© &lt;/&gt;) ‚Üí ÿ≥ÿ¨ŸëŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ<br/>
      4Ô∏è‚É£ ŸÖŸÜ ÿßŸÑŸÇÿßŸäŸÖÿ© ÿßŸÑŸäÿ≥ÿßÿ±: <strong>Build ‚Üí Realtime Database ‚Üí Create database</strong> ‚Üí ÿßÿÆÿ™ÿßÿ± <code>Start in test mode</code><br/>
      5Ô∏è‚É£ ÿßÿ±ÿ¨ÿπ ŸÑŸÄ <strong>Project Settings ‚Üí SDK setup</strong> ‚Üí ÿßŸÜÿ≥ÿÆ ÿßŸÑŸÄ config<br/>
      6Ô∏è‚É£ ÿßŸÅÿ™ÿ≠ ŸÖŸÑŸÅ <code>index.html</code> ŸÅŸä ÿ£Ÿä text editor Ÿàÿ≠ÿ∑ ÿßŸÑŸÄ config ŸÅŸä ŸÖŸÉÿßŸÜŸá<br/>
    </p>
  </div>

  <div class="home-grid fade-in" style="animation-delay:.1s">
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">üë• Clients</div>
        <button class="btn-add" onclick="openAddClient()">Ôºã New Client</button>
      </div>
      <div class="clients-body" id="clients-grid">
        <div class="loading-hint">Connecting to database...</div>
      </div>
    </div>

    <div class="panel">
      <div class="panel-header"><div class="panel-title">‚úÖ Tasks</div></div>
      <div class="tasks-tabs">
        <div class="tasks-tab active" data-tab="copy" onclick="switchTab('copy')">‚úçÔ∏è Copy</div>
        <div class="tasks-tab" data-tab="motion" onclick="switchTab('motion')">üé¨ Motion</div>
        <div class="tasks-tab" data-tab="design" onclick="switchTab('design')">üé® Design</div>
      </div>
      <div class="tasks-body">
        <div id="tab-copy" class="tab-content active"></div>
        <div id="tab-motion" class="tab-content"></div>
        <div id="tab-design" class="tab-content"></div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- DASHBOARD PAGE -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="page-dashboard" class="page">
  <div class="top-bar">
    <button class="back-btn" onclick="goHome()">‚Üê Back</button>
    <div class="sync-badge saving" id="dash-sync"><div class="pulse"></div> <span id="dash-sync-txt">Saving...</span></div>
  </div>

  <div class="client-banner fade-in">
    <div class="av" id="dash-av"></div>
    <div class="info"><h2 id="dash-name"></h2><p id="dash-since"></p></div>
    <div class="banner-right"></div>
  </div>

  <div class="dates-row fade-in" style="animation-delay:.1s">
    <div class="date-card c-con">
      <div class="card-label">Contract</div>
      <input class="card-name-input" id="con-name" placeholder="Contract name..." oninput="dSave()"/>
      <div class="date-fields">
        <div class="date-field"><label>Start</label><input type="date" id="con-start" onchange="calcDays('con');dSave()"/></div>
        <div class="date-field"><label>End</label><input type="date" id="con-end" onchange="calcDays('con');dSave()"/></div>
      </div>
      <div class="days-display pos" id="con-days">‚Äî</div><div class="days-sub" id="con-sub">days remaining</div>
    </div>
    <div class="date-card c-sm">
      <div class="card-label">Social Media</div>
      <input class="card-name-input" id="sm-name" placeholder="Campaign name..." oninput="dSave()"/>
      <div class="date-fields">
        <div class="date-field"><label>Start</label><input type="date" id="sm-start" onchange="calcDays('sm');dSave()"/></div>
        <div class="date-field"><label>End</label><input type="date" id="sm-end" onchange="calcDays('sm');dSave()"/></div>
      </div>
      <div class="days-display pos" id="sm-days">‚Äî</div><div class="days-sub" id="sm-sub">days remaining</div>
    </div>
    <div class="date-card c-mb">
      <div class="card-label">Media Buying</div>
      <input class="card-name-input" id="mb-name" placeholder="Campaign name..." oninput="dSave()"/>
      <div class="date-fields">
        <div class="date-field"><label>Start</label><input type="date" id="mb-start" onchange="calcDays('mb');dSave()"/></div>
        <div class="date-field"><label>End</label><input type="date" id="mb-end" onchange="calcDays('mb');dSave()"/></div>
      </div>
      <div class="days-display pos" id="mb-days">‚Äî</div><div class="days-sub" id="mb-sub">days remaining</div>
    </div>
    <div class="date-card c-seo">
      <div class="card-label">SEO</div>
      <input class="card-name-input" id="seo-name" placeholder="Campaign name..." oninput="dSave()"/>
      <div class="date-fields">
        <div class="date-field"><label>Start</label><input type="date" id="seo-start" onchange="calcDays('seo');dSave()"/></div>
        <div class="date-field"><label>End</label><input type="date" id="seo-end" onchange="calcDays('seo');dSave()"/></div>
      </div>
      <div class="days-display pos" id="seo-days">‚Äî</div><div class="days-sub" id="seo-sub">days remaining</div>
    </div>
  </div>

  <div class="overall-row fade-in" style="animation-delay:.2s">
    <div class="overall-card">
      <div class="overall-top"><span class="overall-name" style="color:var(--social)">üì± Social Media</span><span class="overall-pct" id="sm-pct" style="color:var(--social)">0%</span></div>
      <div class="overall-bar"><div class="overall-fill" id="sm-bar" style="width:0%;background:var(--social)"></div></div>
    </div>
    <div class="overall-card">
      <div class="overall-top"><span class="overall-name" style="color:var(--media)">üì∫ Media Buying</span><span class="overall-pct" id="mb-pct" style="color:var(--media)">0%</span></div>
      <div class="overall-bar"><div class="overall-fill" id="mb-bar" style="width:0%;background:var(--media)"></div></div>
    </div>
    <div class="overall-card">
      <div class="overall-top"><span class="overall-name" style="color:var(--seo)">üîç SEO</span><span class="overall-pct" id="seo-pct" style="color:var(--seo)">0%</span></div>
      <div class="overall-bar"><div class="overall-fill" id="seo-bar" style="width:0%;background:var(--seo)"></div></div>
    </div>
  </div>

  <!-- SM TABLE -->
  <div class="section-card fade-in" style="animation-delay:.3s">
    <div class="section-header"><div class="section-dot" style="background:var(--social)"></div><div class="section-title" style="color:var(--social)">Social Media</div></div>
    <div class="task-table"><table id="sm-table">
      <thead><tr><th></th><th>Brief</th><th>Access/Create</th><th>Audit</th><th>Content Plan</th><th>Design</th><th>Videos</th><th>Publish</th><th>Wk1 üìã</th><th>Wk2 üìã</th><th>Wk3 üìã</th><th>Monthly üìã</th></tr></thead>
      <tbody>
        <tr><td>Status</td>
          <td><select class="status-sel pending" onchange="onSel(this,'sm')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><select class="status-sel pending" onchange="onSel(this,'sm')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><select class="status-sel pending" onchange="onSel(this,'sm')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><select class="status-sel pending" onchange="onSel(this,'sm')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><select class="status-sel pending" onchange="onSel(this,'sm')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><select class="status-sel pending" onchange="onSel(this,'sm')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><select class="status-sel pending" onchange="onSel(this,'sm')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><div class="report-check"><input type="checkbox" class="chk" onchange="dSave()"/><label>Sent</label></div></td>
          <td><div class="report-check"><input type="checkbox" class="chk" onchange="dSave()"/><label>Sent</label></div></td>
          <td><div class="report-check"><input type="checkbox" class="chk" onchange="dSave()"/><label>Sent</label></div></td>
          <td><div class="report-check"><input type="checkbox" class="chk" onchange="dSave()"/><label>Sent</label></div></td>
        </tr>
        <tr><td>Deadline</td>
          <td><input type="date" class="dl-input" onchange="dSave()"/></td><td><input type="date" class="dl-input" onchange="dSave()"/></td>
          <td><input type="date" class="dl-input" onchange="dSave()"/></td><td><input type="date" class="dl-input" onchange="dSave()"/></td>
          <td><input type="date" class="dl-input" onchange="dSave()"/></td><td><input type="date" class="dl-input" onchange="dSave()"/></td>
          <td><input type="date" class="dl-input" onchange="dSave()"/></td><td colspan="4"></td>
        </tr>
        <tr><td>Link</td>
          <td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td><td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td>
          <td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td><td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td>
          <td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td><td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td>
          <td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td><td colspan="4"></td>
        </tr>
        <tr><td>Note</td><td colspan="7"><input class="inline-input" placeholder="Note..." oninput="dSave()"/></td><td colspan="4"></td></tr>
        <tr><td>Progress</td><td colspan="7"><div class="prog-wrap"><div class="prog-bar"><div class="prog-fill" id="sm-prog" style="width:0%;background:var(--social)"></div></div><span class="prog-label" id="sm-prog-lbl" style="color:var(--social)">0%</span></div></td><td colspan="4"></td></tr>
      </tbody>
    </table></div>
  </div>

  <!-- MB TABLE -->
  <div class="section-card fade-in" style="animation-delay:.4s">
    <div class="section-header"><div class="section-dot" style="background:var(--media)"></div><div class="section-title" style="color:var(--media)">Media Buying</div></div>
    <div class="task-table"><table id="mb-table">
      <thead><tr><th></th><th>Brief</th><th>Access/Create</th><th>Audit</th><th>Tracking</th><th>Media Plan</th><th>Design</th><th>Videos</th><th>ADS</th><th>Wk1 üìã</th><th>Wk2 üìã</th><th>Wk3 üìã</th><th>Monthly üìã</th></tr></thead>
      <tbody>
        <tr><td>Status</td>
          <td><select class="status-sel pending" onchange="onSel(this,'mb')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><select class="status-sel pending" onchange="onSel(this,'mb')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><select class="status-sel pending" onchange="onSel(this,'mb')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><select class="status-sel pending" onchange="onSel(this,'mb')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><select class="status-sel pending" onchange="onSel(this,'mb')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><select class="status-sel pending" onchange="onSel(this,'mb')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><select class="status-sel pending" onchange="onSel(this,'mb')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><select class="status-sel pending" onchange="onSel(this,'mb')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><div class="report-check"><input type="checkbox" class="chk" onchange="dSave()"/><label>Sent</label></div></td>
          <td><div class="report-check"><input type="checkbox" class="chk" onchange="dSave()"/><label>Sent</label></div></td>
          <td><div class="report-check"><input type="checkbox" class="chk" onchange="dSave()"/><label>Sent</label></div></td>
          <td><div class="report-check"><input type="checkbox" class="chk" onchange="dSave()"/><label>Sent</label></div></td>
        </tr>
        <tr><td>Deadline</td>
          <td><input type="date" class="dl-input" onchange="dSave()"/></td><td><input type="date" class="dl-input" onchange="dSave()"/></td>
          <td><input type="date" class="dl-input" onchange="dSave()"/></td><td><input type="date" class="dl-input" onchange="dSave()"/></td>
          <td><input type="date" class="dl-input" onchange="dSave()"/></td><td><input type="date" class="dl-input" onchange="dSave()"/></td>
          <td><input type="date" class="dl-input" onchange="dSave()"/></td><td><input type="date" class="dl-input" onchange="dSave()"/></td>
          <td colspan="4"></td>
        </tr>
        <tr><td>Link</td>
          <td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td><td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td>
          <td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td><td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td>
          <td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td><td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td>
          <td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td><td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td>
          <td colspan="4"></td>
        </tr>
        <tr><td>Note</td><td colspan="8"><input class="inline-input" placeholder="Note..." oninput="dSave()"/></td><td colspan="4"></td></tr>
        <tr><td>Progress</td><td colspan="8"><div class="prog-wrap"><div class="prog-bar"><div class="prog-fill" id="mb-prog" style="width:0%;background:var(--media)"></div></div><span class="prog-label" id="mb-prog-lbl" style="color:var(--media)">0%</span></div></td><td colspan="4"></td></tr>
      </tbody>
    </table></div>
  </div>

  <!-- SEO TABLE -->
  <div class="section-card fade-in" style="animation-delay:.5s">
    <div class="section-header"><div class="section-dot" style="background:var(--seo)"></div><div class="section-title" style="color:var(--seo)">SEO</div></div>
    <div class="task-table"><table id="seo-table">
      <thead><tr><th></th><th>Brief</th><th>Access</th><th>Audit Website</th><th>SEO Plan</th><th>UI</th><th>Logo</th><th>Content</th><th>Launch</th><th>Wk1 üìã</th><th>Wk2 üìã</th><th>Wk3 üìã</th><th>Monthly üìã</th></tr></thead>
      <tbody>
        <tr><td>Status</td>
          <td><select class="status-sel pending" onchange="onSel(this,'seo')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><select class="status-sel pending" onchange="onSel(this,'seo')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><select class="status-sel pending" onchange="onSel(this,'seo')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><select class="status-sel pending" onchange="onSel(this,'seo')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><select class="status-sel pending" onchange="onSel(this,'seo')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><select class="status-sel pending" onchange="onSel(this,'seo')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><select class="status-sel pending" onchange="onSel(this,'seo')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><select class="status-sel pending" onchange="onSel(this,'seo')"><option value="pending">Pending</option><option value="done">Done</option><option value="hold">Hold</option></select></td>
          <td><div class="report-check"><input type="checkbox" class="chk" onchange="dSave()"/><label>Sent</label></div></td>
          <td><div class="report-check"><input type="checkbox" class="chk" onchange="dSave()"/><label>Sent</label></div></td>
          <td><div class="report-check"><input type="checkbox" class="chk" onchange="dSave()"/><label>Sent</label></div></td>
          <td><div class="report-check"><input type="checkbox" class="chk" onchange="dSave()"/><label>Sent</label></div></td>
        </tr>
        <tr><td>Deadline</td>
          <td><input type="date" class="dl-input" onchange="dSave()"/></td><td><input type="date" class="dl-input" onchange="dSave()"/></td>
          <td><input type="date" class="dl-input" onchange="dSave()"/></td><td><input type="date" class="dl-input" onchange="dSave()"/></td>
          <td><input type="date" class="dl-input" onchange="dSave()"/></td><td><input type="date" class="dl-input" onchange="dSave()"/></td>
          <td><input type="date" class="dl-input" onchange="dSave()"/></td><td><input type="date" class="dl-input" onchange="dSave()"/></td>
          <td colspan="4"></td>
        </tr>
        <tr><td>Link</td>
          <td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td><td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td>
          <td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td><td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td>
          <td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td><td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td>
          <td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td><td><input class="inline-input" placeholder="Link..." oninput="dSave()"/></td>
          <td colspan="4"></td>
        </tr>
        <tr><td>Note</td><td colspan="8"><input class="inline-input" placeholder="Note..." oninput="dSave()"/></td><td colspan="4"></td></tr>
        <tr><td>Progress</td><td colspan="8"><div class="prog-wrap"><div class="prog-bar"><div class="prog-fill" id="seo-prog" style="width:0%;background:var(--seo)"></div></div><span class="prog-label" id="seo-prog-lbl" style="color:var(--seo)">0%</span></div></td><td colspan="4"></td></tr>
      </tbody>
    </table></div>
  </div>

  <div class="charts-section fade-in" style="animation-delay:.6s">
    <h2>üìä Analytics</h2>
    <div class="charts-grid">
      <div class="chart-card"><div class="chart-title"><div class="dot" style="background:var(--social)"></div>Social Media</div><div class="chart-wrap"><canvas id="smDonut"></canvas></div></div>
      <div class="chart-card"><div class="chart-title"><div class="dot" style="background:var(--media)"></div>Media Buying</div><div class="chart-wrap"><canvas id="mbDonut"></canvas></div></div>
      <div class="chart-card"><div class="chart-title"><div class="dot" style="background:var(--seo)"></div>SEO</div><div class="chart-wrap"><canvas id="seoDonut"></canvas></div></div>
    </div>
    <div class="charts-grid-2">
      <div class="chart-card"><div class="chart-title">üìà Progress Comparison</div><div class="chart-wrap-tall"><canvas id="barChart"></canvas></div></div>
      <div class="chart-card"><div class="chart-title">üï∏ Radar</div><div class="chart-wrap-tall"><canvas id="radarChart"></canvas></div></div>
    </div>
  </div>

  <div class="export-section fade-in" style="animation-delay:.7s">
    <button class="btn-rst" onclick="resetDash()">üóë Reset Client Data</button>
    <button class="btn-export" onclick="window.print()">üìÑ Export PDF</button>
  </div>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="modal">
  <div class="modal">
    <h3>‚ûï New Client</h3>
    <label>Client Name *</label>
    <input id="new-client-name" placeholder="e.g. Nike Egypt"/>
    <label>Industry</label>
    <input id="new-client-industry" placeholder="e.g. Fashion, Tech, Food..."/>
    <label>Start Date</label>
    <input type="date" id="new-client-date"/>
    <label>Color</label>
    <select id="new-client-color">
      <option value="#3b82f6">üîµ Blue</option>
      <option value="#f97316">üü† Orange</option>
      <option value="#10b981">üü¢ Green</option>
      <option value="#a855f7">üü£ Purple</option>
      <option value="#ec4899">ü©∑ Pink</option>
      <option value="#06b6d4">ü©µ Cyan</option>
      <option value="#f59e0b">üü° Amber</option>
      <option value="#ef4444">üî¥ Red</option>
    </select>
    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeModal()">Cancel</button>
      <button class="btn-confirm" onclick="addClient()">Create Client</button>
    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GLOBALS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let db, dbRef, dbSet, dbGet, dbOnValue, dbRemove, dbUpdate;
let dbOk = false;
let clients = {};
let taskData = { copy:[], motion:[], design:[] };
let currentClientId = null;
let charts = {};
let saveDebounce = null;

// ‚îÄ‚îÄ Wait for Firebase ‚îÄ‚îÄ
window.addEventListener('db-ready', () => {
  db = window._db; dbRef = window._ref; dbSet = window._set;
  dbGet = window._get; dbOnValue = window._onValue;
  dbRemove = window._remove; dbUpdate = window._update;
  dbOk = true;
  checkConfigured();
});

function checkConfigured() {
  const isDefault = !db || document.querySelector('script[type="module"]').textContent.includes('"YOUR_API_KEY"');
  if(isDefault) {
    setStatus('offline','‚ö†Ô∏è Not Configured');
    document.getElementById('setup-banner').classList.add('show');
    document.getElementById('clients-grid').innerHTML = '<div class="empty-hint">Configure Firebase first ‚Üë</div>';
    // Fallback to localStorage
    loadFromLocal();
    return;
  }
  setStatus('live','üü¢ Live Sync');
  listenClients();
  listenTasks();
}

function setStatus(cls, txt) {
  const el = document.getElementById('db-status');
  el.className = 'sync-badge '+cls;
  el.innerHTML = `<div class="pulse"></div> ${txt}`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FIREBASE ‚Äî CLIENTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function listenClients() {
  dbOnValue(dbRef(db, 'clients'), snap => {
    clients = snap.val() || {};
    renderClients();
  });
}

function listenTasks() {
  dbOnValue(dbRef(db, 'tasks'), snap => {
    taskData = snap.val() || { copy:[], motion:[], design:[] };
    renderTasks();
  });
}

function fbSaveClient(c) {
  if(!dbOk) return;
  dbSet(dbRef(db, 'clients/'+c.id), c);
}

function fbDeleteClient(id) {
  if(!dbOk) return;
  dbRemove(dbRef(db, 'clients/'+id));
  dbRemove(dbRef(db, 'dashboards/'+id));
}

function fbSaveDash(id, data) {
  if(!dbOk) return;
  dbSet(dbRef(db, 'dashboards/'+id), data);
}

function fbLoadDash(id, cb) {
  if(!dbOk) { cb(null); return; }
  dbGet(dbRef(db, 'dashboards/'+id)).then(snap => cb(snap.val()));
}

function fbSaveTasks() {
  if(!dbOk) return;
  dbSet(dbRef(db, 'tasks'), taskData);
}

// LOCAL FALLBACK
function loadFromLocal() {
  clients = JSON.parse(localStorage.getItem('mkt_clients_fb') || '{}');
  taskData = JSON.parse(localStorage.getItem('mkt_tasks_fb') || '{"copy":[],"motion":[],"design":[]}');
  renderClients();
  renderTasks();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HOME
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.getElementById('home-date').textContent = new Date().toLocaleDateString('en-GB',{weekday:'long',day:'numeric',month:'long'});

function showPage(id){ document.querySelectorAll('.page').forEach(p=>p.classList.remove('active')); document.getElementById(id).classList.add('active'); }

function goHome(){ destroyCharts(); showPage('page-home'); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER CLIENTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderClients() {
  const grid = document.getElementById('clients-grid');
  const list = Object.values(clients);
  if(!list.length){ grid.innerHTML='<div class="empty-hint">No clients yet. Add your first ‚Üó</div>'; return; }
  grid.innerHTML = list.map(c => {
    const initials = c.name.split(' ').map(w=>w[0]).join('').toUpperCase().slice(0,2);
    const pct = c.progress || 0;
    return `<div class="client-card" onclick="openClient('${c.id}')">
      <button class="client-del" onclick="event.stopPropagation();deleteClient('${c.id}')" title="Delete">‚úï</button>
      <div class="client-avatar" style="background:${c.color}">${initials}</div>
      <div class="client-name" title="${c.name}">${c.name}</div>
      <div class="client-date">${c.industry||''} ${c.date?'¬∑ '+c.date:''}</div>
      <div class="client-prog"><div class="client-prog-fill" style="width:${pct}%;background:${c.color}"></div></div>
    </div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openAddClient(){ document.getElementById('modal').classList.add('open'); document.getElementById('new-client-name').focus(); }
function closeModal(){ document.getElementById('modal').classList.remove('open'); }

function addClient(){
  const name = document.getElementById('new-client-name').value.trim();
  if(!name){ alert('Client name required'); return; }
  const c = {
    id:'c_'+Date.now(),
    name,
    industry:document.getElementById('new-client-industry').value.trim(),
    date:document.getElementById('new-client-date').value,
    color:document.getElementById('new-client-color').value,
    progress:0,
    createdAt: new Date().toISOString()
  };
  if(dbOk && !document.querySelector('script[type="module"]').textContent.includes('"YOUR_API_KEY"')) {
    fbSaveClient(c);
  } else {
    clients[c.id]=c;
    localStorage.setItem('mkt_clients_fb', JSON.stringify(clients));
    renderClients();
  }
  closeModal();
  ['new-client-name','new-client-industry','new-client-date'].forEach(id=>document.getElementById(id).value='');
  openClient(c.id);
}

function deleteClient(id){
  if(!confirm('Delete this client?')) return;
  if(dbOk && !document.querySelector('script[type="module"]').textContent.includes('"YOUR_API_KEY"')){
    fbDeleteClient(id);
  } else {
    delete clients[id];
    localStorage.setItem('mkt_clients_fb',JSON.stringify(clients));
    renderClients();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TASKS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function switchTab(tab){
  document.querySelectorAll('.tasks-tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
  document.querySelector(`.tasks-tab[data-tab="${tab}"]`).classList.add('active');
  document.getElementById('tab-'+tab).classList.add('active');
}

// ‚îÄ‚îÄ FACTOR MAP ‚îÄ‚îÄ
const FACTOR_MAP = {
  'Edit':0.5,'Story':20,'Script':7,'4 Platforms':3.5,'3 Platforms':2.5,
  '2 Platforms':1.75,'1 Platform':1.5,'Landing Page':8,'Motion':7,
  'Google':3,'MSG':3,'Package Name':2,'Posts':2.5,'Website':35,
  'ŸÖŸÜÿ™ÿ¨ÿßÿ™':3.5,'ŸàÿµŸÅ ÿ£ŸÇÿ≥ÿßŸÖ':3.5,'ŸÖŸÇÿßŸÑÿßÿ™ ÿßŸÑŸÖÿ™ÿ¨ÿ±':3.5,'Posts 2P':5,
  'Linked In':3,'ÿ®ŸÜÿ±ÿßÿ™':1.25,'Ÿàÿßÿ¨Ÿáÿ© ŸÖÿ™ÿ¨ÿ±':8
};
const FORUMS_OPTS = Object.keys(FACTOR_MAP);

function getFactor(f){ return FACTOR_MAP[f] || 0; }
function getKPI(row){ const f=getFactor(row.forums); return parseFloat(((row.no||0)*f).toFixed(2)); }

function calcCopyStats(){
  const rows = taskData.copy||[];
  const done = rows.filter(r=>r.done).length;
  const pending = rows.length - done;
  const kpi = rows.reduce((s,r)=>s+getKPI(r),0).toFixed(1);
  return {done, pending, kpi, total:rows.length};
}

function renderCopyTable(){
  const el = document.getElementById('tab-copy');
  const rows = taskData.copy||[];
  const st = calcCopyStats();
  const today = new Date(); today.setHours(0,0,0,0);

  el.innerHTML = `
    <div class="copy-toolbar">
      <select id="new-media" title="Media / Social">
        <option value="">‚Äî Type ‚Äî</option>
        <option value="Social">Social</option>
        <option value="Media">Media</option>
      </select>
      <input id="new-agency" class="" placeholder="Agency" style="width:80px"/>
      <select id="new-type" title="Type">
        <option value="">‚Äî Sub ‚Äî</option>
        ${FORUMS_OPTS.map(o=>`<option value="${o}">${o}</option>`).join('')}
      </select>
      <input id="new-client" placeholder="Client" style="width:80px"/>
      <input id="new-member" placeholder="Member" style="width:75px"/>
      <input type="number" id="new-no" placeholder="N.O" style="width:52px" min="0"/>
      <input type="date" id="new-deadline" style="width:120px"/>
      <button class="btn-add-row" onclick="addCopyRow()">Ôºã Add Row</button>
      <div class="copy-stats">
        <span class="stat-pill stat-done">‚úì ${st.done}</span>
        <span class="stat-pill stat-pending">‚è≥ ${st.pending}</span>
        <span class="stat-pill stat-kpi">KPI ${st.kpi}</span>
      </div>
    </div>
    <div class="copy-table-wrap">
      <table class="copy-table">
        <thead><tr>
          <th style="width:28px"></th>
          <th>Type</th><th>Agency</th><th>Sub-Type</th>
          <th>Client</th><th>Task Date</th><th>Assign Date</th>
          <th>Notes</th><th>N.O</th><th>Factor</th><th>KPI</th>
          <th>Member</th><th>Platform</th><th>Deadline</th>
          <th>Done</th><th>Agree</th>
        </tr></thead>
        <tbody>
        ${rows.map((r,i)=>{
          const kpi = getKPI(r);
          const overdue = r.deadline && new Date(r.deadline)<today && !r.done;
          return `<tr class="${r.done?'row-done':''}${overdue?' row-overdue':''}">
            <td><button class="ct-rm" onclick="removeCopyRow(${i})" title="Delete">‚úï</button></td>
            <td><select class="ct-sel" onchange="updateCopyRow(${i},'media',this.value)">
              <option value="">‚Äî</option>
              <option value="Social" ${r.media==='Social'?'selected':''}>Social</option>
              <option value="Media" ${r.media==='Media'?'selected':''}>Media</option>
            </select></td>
            <td><input class="ct-inp" value="${r.agency||''}" placeholder="Agency" oninput="updateCopyRow(${i},'agency',this.value)"/></td>
            <td><select class="ct-sel" onchange="updateCopyRow(${i},'forums',this.value)">
              <option value="">‚Äî Sub ‚Äî</option>
              ${FORUMS_OPTS.map(o=>`<option value="${o}" ${r.forums===o?'selected':''}>${o}</option>`).join('')}
            </select></td>
            <td><input class="ct-inp" value="${r.client||''}" placeholder="Client" oninput="updateCopyRow(${i},'client',this.value)"/></td>
            <td><input type="date" class="ct-date" value="${r.taskDate||''}" onchange="updateCopyRow(${i},'taskDate',this.value)"/></td>
            <td><input type="date" class="ct-date" value="${r.assignDate||''}" onchange="updateCopyRow(${i},'assignDate',this.value)"/></td>
            <td><input class="ct-inp" value="${r.notes||''}" placeholder="Notes..." oninput="updateCopyRow(${i},'notes',this.value)" style="min-width:80px"/></td>
            <td><input type="number" class="ct-num" value="${r.no||''}" min="0" oninput="updateCopyRow(${i},'no',parseFloat(this.value)||0)"/></td>
            <td><span class="ct-factor">${getFactor(r.forums)||'‚Äî'}</span></td>
            <td><span class="ct-kpi">${kpi>0?kpi:'‚Äî'}</span></td>
            <td><input class="ct-inp" value="${r.member||''}" placeholder="Member" oninput="updateCopyRow(${i},'member',this.value)"/></td>
            <td><input class="ct-inp" value="${r.platform||''}" placeholder="Platform" oninput="updateCopyRow(${i},'platform',this.value)"/></td>
            <td><input type="date" class="ct-date" value="${r.deadline||''}" onchange="updateCopyRow(${i},'deadline',this.value)"/></td>
            <td><input type="checkbox" class="ct-chk" ${r.done?'checked':''} onchange="updateCopyRow(${i},'done',this.checked)"/></td>
            <td><input type="checkbox" class="ct-chk agree" ${r.agree?'checked':''} onchange="updateCopyRow(${i},'agree',this.checked)"/></td>
          </tr>`;
        }).join('')}
        ${!rows.length?`<tr><td colspan="16" style="text-align:center;padding:24px;color:var(--muted);font-size:12px;">No tasks yet ‚Äî add the first row above ‚Üë</td></tr>`:''}
        </tbody>
      </table>
    </div>`;
}

function addCopyRow(){
  const media=document.getElementById('new-media').value;
  const agency=document.getElementById('new-agency').value.trim();
  const forums=document.getElementById('new-type').value;
  const client=document.getElementById('new-client').value.trim();
  const member=document.getElementById('new-member').value.trim();
  const no=parseFloat(document.getElementById('new-no').value)||0;
  const deadline=document.getElementById('new-deadline').value;
  if(!taskData.copy) taskData.copy=[];
  taskData.copy.push({media,agency,forums,client,member,no,deadline,taskDate:'',assignDate:'',notes:'',platform:'',done:false,agree:false});
  saveTasks();
  // Clear some fields
  document.getElementById('new-client').value='';
  document.getElementById('new-no').value='';
  document.getElementById('new-deadline').value='';
}

function updateCopyRow(i,field,val){
  if(!taskData.copy[i]) return;
  taskData.copy[i][field]=val;
  saveTasks(false); // don't re-render while user typing EXCEPT for done/agree/forums
  if(field==='done'||field==='agree'||field==='forums') saveTasks(true);
}

function removeCopyRow(i){
  taskData.copy.splice(i,1);
  saveTasks(true);
}

// Motion / Design simple list
function renderSimpleTab(tab){
  const color = tab==='motion'?'var(--motion)':'var(--design)';
  const el = document.getElementById('tab-'+tab);
  const items = (taskData[tab]||[]);
  el.innerHTML=`
    <div class="task-input-row">
      <input id="tinput-${tab}" placeholder="Add task..." onkeydown="if(event.key==='Enter')addSimpleTask('${tab}')"/>
      <select id="tpri-${tab}">
        <option value="high">üî¥ High</option>
        <option value="med" selected>üü° Med</option>
        <option value="low">‚ö™ Low</option>
      </select>
      <button onclick="addSimpleTask('${tab}')" style="background:${color};color:#fff;border:none;border-radius:8px;padding:8px 14px;font-size:14px;cursor:pointer;">+</button>
    </div>
    <div class="task-list">
      ${items.map((t,i)=>`
      <div class="task-item ${t.done?'done-item':''}">
        <input type="checkbox" class="task-chk" ${t.done?'checked':''} onchange="toggleSimpleTask('${tab}',${i})"/>
        <span class="task-text ${t.done?'done-text':''}">${t.text}</span>
        <span class="task-priority pri-${t.priority||'med'}">${t.priority||'med'}</span>
        <button class="task-rm" onclick="removeSimpleTask('${tab}',${i})">‚úï</button>
      </div>`).join('')}
      ${!items.length?'<div style="color:var(--muted);font-size:11px;text-align:center;padding:16px">No tasks yet</div>':''}
    </div>`;
}

function renderTasks(){
  renderCopyTable();
  renderSimpleTab('motion');
  renderSimpleTab('design');
}

function addSimpleTask(tab){
  const inp=document.getElementById('tinput-'+tab);
  const text=inp.value.trim(); if(!text) return;
  const pri=document.getElementById('tpri-'+tab).value;
  if(!taskData[tab]) taskData[tab]=[];
  taskData[tab].push({text,priority:pri,done:false});
  saveTasks(true); inp.value=''; inp.focus();
}
function toggleSimpleTask(tab,i){ taskData[tab][i].done=!taskData[tab][i].done; saveTasks(true); }
function removeSimpleTask(tab,i){ taskData[tab].splice(i,1); saveTasks(true); }

let saveTasksTimer=null;
function saveTasks(rerender=true){
  if(dbOk && !document.querySelector('script[type="module"]').textContent.includes('"YOUR_API_KEY"')){
    fbSaveTasks();
  } else {
    localStorage.setItem('mkt_tasks_fb',JSON.stringify(taskData));
  }
  if(rerender) renderTasks();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openClient(id){
  currentClientId=id;
  const c=clients[id]; if(!c) return;
  showPage('page-dashboard');
  const initials=c.name.split(' ').map(w=>w[0]).join('').toUpperCase().slice(0,2);
  const av=document.getElementById('dash-av');
  av.textContent=initials; av.style.background=c.color;
  document.getElementById('dash-name').textContent=c.name;
  document.getElementById('dash-since').textContent=(c.industry||'')+(c.date?' ¬∑ Since '+c.date:'');
  resetFormOnly();
  setSyncStatus('saving','‚è≥ Loading...');
  fbLoadDash(id, data=>{
    if(data) applyDashData(data);
    ['con','sm','mb','seo'].forEach(s=>calcDays(s));
    ['sm','mb','seo'].forEach(recalc);
    destroyCharts(); initCharts(); updateCharts();
    setSyncStatus('live','üü¢ Synced');
  });
}

function setSyncStatus(cls,txt){
  const el=document.getElementById('dash-sync');
  if(!el) return;
  el.className='sync-badge '+cls;
  el.innerHTML=`<div class="pulse"></div> ${txt}`;
}

function resetFormOnly(){
  document.querySelectorAll('#page-dashboard .status-sel').forEach(s=>{s.value='pending';s.className='status-sel pending';});
  document.querySelectorAll('#page-dashboard .card-name-input,.dl-input,.inline-input').forEach(i=>i.value='');
  document.querySelectorAll('#page-dashboard input[type="date"]').forEach(i=>i.value='');
  document.querySelectorAll('#page-dashboard .chk').forEach(c=>c.checked=false);
}

function gatherDashData(){
  const data={};
  ['con-name','sm-name','mb-name','seo-name'].forEach(id=>{const e=document.getElementById(id);if(e)data[id]=e.value;});
  document.querySelectorAll('#page-dashboard input[type="date"]').forEach((e,i)=>data['d'+i]=e.value);
  document.querySelectorAll('#page-dashboard .status-sel').forEach((e,i)=>data['s'+i]=e.value);
  data.selects=Array.from(document.querySelectorAll('#page-dashboard .status-sel')).map(s=>s.value);
  document.querySelectorAll('#page-dashboard .dl-input').forEach((e,i)=>data['dl'+i]=e.value);
  document.querySelectorAll('#page-dashboard .inline-input').forEach((e,i)=>data['in'+i]=e.value);
  document.querySelectorAll('#page-dashboard .chk').forEach((e,i)=>data['ck'+i]=e.checked);
  return data;
}

function applyDashData(data){
  ['con-name','sm-name','mb-name','seo-name'].forEach(id=>{const e=document.getElementById(id);if(e&&data[id]!==undefined)e.value=data[id];});
  document.querySelectorAll('#page-dashboard input[type="date"]').forEach((e,i)=>{if(data['d'+i]!==undefined)e.value=data['d'+i];});
  document.querySelectorAll('#page-dashboard .status-sel').forEach((e,i)=>{if(data['s'+i]!==undefined){e.value=data['s'+i];e.className='status-sel '+e.value;}});
  document.querySelectorAll('#page-dashboard .dl-input').forEach((e,i)=>{if(data['dl'+i]!==undefined)e.value=data['dl'+i];});
  document.querySelectorAll('#page-dashboard .inline-input').forEach((e,i)=>{if(data['in'+i]!==undefined)e.value=data['in'+i];});
  document.querySelectorAll('#page-dashboard .chk').forEach((e,i)=>{if(data['ck'+i]!==undefined)e.checked=data['ck'+i];});
}

function dSave(){
  if(!currentClientId) return;
  setSyncStatus('saving','üíæ Saving...');
  clearTimeout(saveDebounce);
  saveDebounce=setTimeout(()=>{
    const data=gatherDashData();
    // Update progress on client
    if(clients[currentClientId]){
      const done=(data.selects||[]).filter(v=>v==='done').length;
      const pct=Math.round(done/((data.selects||[]).length||1)*100);
      clients[currentClientId].progress=pct;
      fbSaveClient(clients[currentClientId]);
    }
    if(dbOk && !document.querySelector('script[type="module"]').textContent.includes('"YOUR_API_KEY"')){
      fbSaveDash(currentClientId,data);
      setSyncStatus('live','üü¢ Synced');
    } else {
      localStorage.setItem('mkt_dash_local_'+currentClientId,JSON.stringify(data));
      setSyncStatus('live','‚úì Saved locally');
    }
  },600);
}

function resetDash(){
  if(!confirm('Reset all data for this client?')) return;
  if(dbOk) dbRemove(dbRef(db,'dashboards/'+currentClientId));
  localStorage.removeItem('mkt_dash_local_'+currentClientId);
  resetFormOnly();
  ['sm','mb','seo'].forEach(recalc);
  updateCharts();
}

// ‚îÄ‚îÄ DATES ‚îÄ‚îÄ
function calcDays(sec){
  const s=document.getElementById(sec+'-start');
  const e=document.getElementById(sec+'-end');
  const el=document.getElementById(sec+'-days');
  const sub=document.getElementById(sec+'-sub');
  if(!s||!e||!s.value||!e.value){if(el)el.textContent='‚Äî';return;}
  const today=new Date();today.setHours(0,0,0,0);
  const end=new Date(e.value),start=new Date(s.value);
  const total=Math.round((end-start)/86400000);
  const remain=Math.round((end-today)/86400000);
  el.textContent=remain;
  el.className='days-display '+(remain<0?'neg':'pos');
  if(sub) sub.textContent='Total: '+total+' days';
}

// ‚îÄ‚îÄ STATUS ‚îÄ‚îÄ
function onSel(sel,sec){sel.className='status-sel '+sel.value;recalc(sec);updateCharts();dSave();}
function recalc(sec){
  const sels=document.querySelectorAll('#'+sec+'-table tbody tr:first-child select.status-sel');
  let done=0; sels.forEach(s=>{if(s.value==='done')done++;});
  const pct=Math.round(done/sels.length*100);
  document.getElementById(sec+'-prog').style.width=pct+'%';
  document.getElementById(sec+'-prog-lbl').textContent=pct+'%';
  document.getElementById(sec+'-pct').textContent=pct+'%';
  document.getElementById(sec+'-bar').style.width=pct+'%';
}

// ‚îÄ‚îÄ CHARTS ‚îÄ‚îÄ
Chart.defaults.color='#64748b'; Chart.defaults.borderColor='#252a38';
function initCharts(){
  function mk(id,color){return new Chart(document.getElementById(id),{type:'doughnut',data:{labels:['Done','Hold','Pending'],datasets:[{data:[0,0,1],backgroundColor:[color,'rgba(245,158,11,.6)','rgba(100,116,139,.2)'],borderWidth:0,hoverOffset:4}]},options:{responsive:true,maintainAspectRatio:false,cutout:'72%',plugins:{legend:{position:'bottom',labels:{font:{size:10},padding:8,boxWidth:8}}}}});}
  charts.smD=mk('smDonut','#3b82f6');
  charts.mbD=mk('mbDonut','#f97316');
  charts.seoD=mk('seoDonut','#10b981');
  charts.bar=new Chart(document.getElementById('barChart'),{type:'bar',data:{labels:['Social','Media','SEO'],datasets:[{label:'Done',data:[0,0,0],backgroundColor:'rgba(16,185,129,.8)',borderRadius:5},{label:'Hold',data:[0,0,0],backgroundColor:'rgba(245,158,11,.8)',borderRadius:5},{label:'Pending',data:[7,8,8],backgroundColor:'rgba(100,116,139,.3)',borderRadius:5}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom'}},scales:{x:{stacked:true,grid:{color:'#252a38'}},y:{stacked:true,grid:{color:'#252a38'},ticks:{stepSize:1}}}}});
  charts.rad=new Chart(document.getElementById('radarChart'),{type:'radar',data:{labels:['Brief','Access','Audit','Plan','Design','Videos','Pub'],datasets:[{label:'Social',data:[0,0,0,0,0,0,0],backgroundColor:'rgba(59,130,246,.2)',borderColor:'#3b82f6',pointBackgroundColor:'#3b82f6',borderWidth:2},{label:'Media',data:[0,0,0,0,0,0,0],backgroundColor:'rgba(249,115,22,.2)',borderColor:'#f97316',pointBackgroundColor:'#f97316',borderWidth:2},{label:'SEO',data:[0,0,0,0,0,0,0],backgroundColor:'rgba(16,185,129,.2)',borderColor:'#10b981',pointBackgroundColor:'#10b981',borderWidth:2}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom'}},scales:{r:{grid:{color:'#252a38'},ticks:{display:false},pointLabels:{font:{size:9},color:'#94a3b8'},min:0,max:1}}}});
}
function getStats(sec){const sels=document.querySelectorAll('#'+sec+'-table tbody tr:first-child select.status-sel');let done=0,hold=0,pending=0;sels.forEach(s=>{if(s.value==='done')done++;else if(s.value==='hold')hold++;else pending++;});return{done,hold,pending};}
function updateCharts(){
  if(!charts.smD) return;
  ['sm','mb','seo'].forEach((s,i)=>{const st=getStats(s);const d=[charts.smD,charts.mbD,charts.seoD][i];d.data.datasets[0].data=[st.done,st.hold,st.pending];d.update();});
  const s1=getStats('sm'),s2=getStats('mb'),s3=getStats('seo');
  charts.bar.data.datasets[0].data=[s1.done,s2.done,s3.done];
  charts.bar.data.datasets[1].data=[s1.hold,s2.hold,s3.hold];
  charts.bar.data.datasets[2].data=[s1.pending,s2.pending,s3.pending];
  charts.bar.update();
}
function destroyCharts(){Object.values(charts).forEach(c=>{try{c.destroy();}catch(e){}});charts={};}

// Init
document.getElementById('modal').addEventListener('click',function(e){if(e.target===this)closeModal();});
</script>

<!-- CRM PAGE -->
<div id="page-crm" class="page">
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid var(--border);">
  <button class="back-btn" onclick="showPage('page-home');document.querySelector('.nav-crm-btn').classList.remove('active')">‚Üê Back</button>
  <div style="font-family:'Syne',sans-serif;font-size:20px;font-weight:800;">CRM <span style="color:var(--copy)">Tracker</span></div>
  <span id="saveDot" style="font-size:11px;color:var(--done);opacity:0;transition:opacity .4s;">‚úì Saved</span>
</div>
<!-- MAIN CLIENTS TABLE -->
<div class="panel fade-in" style="animation-delay:.1s">
  <div class="panel-header">
    <div class="panel-title">üìã Client Projects</div>
    <div class="panel-actions">
      <button class="btn btn-primary btn-sm" onclick="openModal()">Ôºã Add Client</button>
    </div>
  </div>

  <div class="toolbar">
    <input id="searchInp" placeholder="üîç Search..." oninput="renderTable()" style="width:180px"/>
    <select id="filterPkg" onchange="renderTable()">
      <option value="">All Packages</option>
      <option value="Full">Full</option>
      <option value="Ads">Ads</option>
      <option value="Social">Social</option>
      <option value="SEO">SEO</option>
    </select>
    <select id="filterMedia" onchange="renderTable()">
      <option value="">All Media Buyers</option>
    </select>
    <select id="filterSeo" onchange="renderTable()">
      <option value="">All SEO</option>
    </select>
    <div class="filter-grp">
      <button class="filter-btn active" data-f="all" onclick="setFilter('all')">All</button>
      <button class="filter-btn f-new" data-f="ÿ¨ÿØÿØ" onclick="setFilter('ÿ¨ÿØÿØ')">ÿ¨ÿØÿØ</button>
      <button class="filter-btn f-renewed" data-f="ŸÖÿ¨ÿØÿØ" onclick="setFilter('ŸÖÿ¨ÿØÿØ')">ŸÖÿ¨ÿØÿØ</button>
      <button class="filter-btn f-hold" data-f="ŸáŸàŸÑÿØ" onclick="setFilter('ŸáŸàŸÑÿØ')">Hold</button>
      <button class="filter-btn f-lost" data-f="ŸÅŸÇÿØ" onclick="setFilter('ŸÅŸÇÿØ')">ŸÅŸÇÿØ</button>
    </div>
  </div>

  <div class="table-wrap" style="max-height:520px;overflow-y:auto;">
    <table class="main-table">
      <thead><tr>
        <th style="width:30px">#</th>
        <th>Project Name</th>
        <th>End Date</th>
        <th>Days Left</th>
        <th style="text-align:center">Meeting</th>
        <th>Status</th>
        <th style="text-align:center">Upsell</th>
        <th>SEO</th>
        <th>Social</th>
        <th>Media Buyer</th>
        <th>Acc. Manager</th>
        <th>Package</th>
        <th style="width:32px"></th>
      </tr></thead>
      <tbody id="mainBody"></tbody>
    </table>
  </div>
</div>

<!-- STATS ROW -->
<div class="stats-grid fade-in" style="animation-delay:.2s">

  <!-- Media Buyers Stats -->
  <div class="panel">
    <div class="panel-header">
      <div class="panel-title">üì∫ Media Buyers</div>
    </div>
    <div style="overflow-x:auto;">
      <table class="stats-table" id="mbStatsTable">
        <thead><tr>
          <th>Name</th><th>Clients</th><th>Target</th><th>Renewal</th><th>Remain</th>
          <th>ÿ¨ÿØÿØ</th><th>ŸÖÿ¨ÿØÿØ</th><th>ŸÅŸÇÿØ</th><th>%</th><th>Upsell</th>
        </tr></thead>
        <tbody id="mbStatsBody"></tbody>
      </table>
    </div>
  </div>

  <!-- SEO + Overall Stats -->
  <div style="display:flex;flex-direction:column;gap:16px;">
    <div class="panel">
      <div class="panel-header"><div class="panel-title">üîç SEO Members</div></div>
      <div style="overflow-x:auto;">
        <table class="stats-table" id="seoStatsTable">
          <thead><tr>
            <th>Name</th><th>Clients</th><th>Target</th><th>Renewal</th><th>%</th>
          </tr></thead>
          <tbody id="seoStatsBody"></tbody>
        </table>
      </div>
    </div>

    <div class="panel">
      <div class="panel-header"><div class="panel-title">üìä Overall</div></div>
      <div class="overall-stats" id="overallStats">
        <div class="ov-item"><div class="ov-label">Total</div><div class="ov-val" id="ov-total">0</div></div>
        <div class="ov-item"><div class="ov-label">Done ‚úì</div><div class="ov-val" id="ov-done" style="color:var(--done)">0</div></div>
        <div class="ov-item"><div class="ov-label">ÿ¨ÿØÿØ</div><div class="ov-val" id="ov-new" style="color:var(--new)">0</div></div>
        <div class="ov-item"><div class="ov-label">Upsell</div><div class="ov-val" id="ov-upsell" style="color:var(--copy)">0</div></div>
        <div class="ov-item"><div class="ov-label">Hold</div><div class="ov-val" id="ov-hold" style="color:var(--hold)">0</div></div>
        <div class="ov-item"><div class="ov-label">ŸÅŸÇÿØ</div><div class="ov-val" id="ov-lost" style="color:var(--lost)">0</div></div>
      </div>
      <div style="padding:0 20px 16px;display:grid;grid-template-columns:repeat(4,1fr);gap:8px;" id="pkgStats"></div>
    </div>
  </div>
</div>

<!-- ADD CLIENT MODAL -->
<div class="modal-overlay" id="modal">
  <div class="modal">
    <h3>‚ûï Add Client</h3>
    <div class="form-grid">
      <div class="form-group full">
        <label>Project Name *</label>
        <input id="f-name" placeholder="Client / Project name"/>
      </div>
      <div class="form-group">
        <label>End Date</label>
        <input type="date" id="f-end"/>
      </div>
      <div class="form-group">
        <label>Package</label>
        <select id="f-pkg">
          <option value="">‚Äî Select ‚Äî</option>
          <option value="Full">Full</option>
          <option value="Ads">Ads</option>
          <option value="Social">Social</option>
          <option value="SEO">SEO</option>
        </select>
      </div>
      <div class="form-group">
        <label>Status</label>
        <select id="f-status">
          <option value="ÿ¨ÿØÿØ">ÿ¨ÿØÿØ (New)</option>
          <option value="ŸÖÿ¨ÿØÿØ">ŸÖÿ¨ÿØÿØ (Renewed)</option>
          <option value="ÿ¨ÿØÿØ ÿ≥Ÿàÿ¥ŸäÿßŸÑ">ÿ¨ÿØÿØ ÿ≥Ÿàÿ¥ŸäÿßŸÑ</option>
          <option value="ÿ¨ÿØÿØ ÿ≥ŸäŸà">ÿ¨ÿØÿØ ÿ≥ŸäŸà</option>
          <option value="ŸáŸàŸÑÿØ">ŸáŸàŸÑÿØ (Hold)</option>
          <option value="ŸÅŸÇÿØ">ŸÅŸÇÿØ (Lost)</option>
        </select>
      </div>
      <div class="form-group">
        <label>Media Buyer</label>
        <input id="f-media" placeholder="Name" list="media-list"/>
        <datalist id="media-list"></datalist>
      </div>
      <div class="form-group">
        <label>SEO</label>
        <input id="f-seo" placeholder="Name" list="seo-list"/>
        <datalist id="seo-list"></datalist>
      </div>
      <div class="form-group">
        <label>Social Media</label>
        <input id="f-social" placeholder="Name" list="social-list"/>
        <datalist id="social-list"></datalist>
      </div>
      <div class="form-group full">
        <label>Account Manager</label>
        <input id="f-acm" placeholder="Name" list="acm-list"/>
        <datalist id="acm-list"></datalist>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeModal()">Cancel</button>
      <button class="btn-confirm" onclick="addRow()">Add Client</button>
    </div>
  </div>
</div>


</div>

<script>
// ‚ïê‚ïê‚ïê CRM ‚ïê‚ïê‚ïê

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const KEY = 'crm_data_v1';
let rows = JSON.parse(localStorage.getItem(KEY) || '[]');
let activeFilter = 'all';
let saveTimer;

const STATUS_OPTS = ['ÿ¨ÿØÿØ','ŸÖÿ¨ÿØÿØ','ÿ¨ÿØÿØ ÿ≥Ÿàÿ¥ŸäÿßŸÑ','ÿ¨ÿØÿØ ÿ≥ŸäŸà','ŸáŸàŸÑÿØ','ŸÅŸÇÿØ',''];
const PKG_OPTS = ['Full','Ads','Social','SEO',''];

document.getElementById('topDate').textContent = new Date().toLocaleDateString('en-GB',{weekday:'long',day:'numeric',month:'long',year:'numeric'});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DAYS CALC
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function daysLeft(dateStr){
  if(!dateStr) return null;
  const today = new Date(); today.setHours(0,0,0,0);
  const end = new Date(dateStr);
  return Math.round((end - today) / 86400000);
}

function daysClass(d){
  if(d === null) return '';
  if(d < 0) return 'days-over';
  if(d <= 14) return 'days-warn';
  return 'days-ok';
}

function daysText(d){
  if(d === null) return '‚Äî';
  if(d < 0) return `${Math.abs(d)}d over`;
  return `${d}d`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATUS helpers
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function statusClass(s){
  if(!s) return 's-other';
  if(s.includes('ÿ¨ÿØÿØ')) return 's-new';
  if(s.includes('ŸÖÿ¨ÿØÿØ')) return 's-renewed';
  if(s === 'ŸáŸàŸÑÿØ') return 's-hold';
  if(s === 'ŸÅŸÇÿØ') return 's-lost';
  return 's-other';
}
function rowClass(s){
  if(!s) return '';
  if(s.includes('ÿ¨ÿØÿØ')) return 'row-new';
  if(s.includes('ŸÖÿ¨ÿØÿØ')) return 'row-renewed';
  if(s === 'ŸáŸàŸÑÿØ') return 'row-hold';
  if(s === 'ŸÅŸÇÿØ') return 'row-lost';
  return '';
}
function pkgClass(p){
  if(p==='Full') return 'pkg-full';
  if(p==='Ads') return 'pkg-ads';
  if(p==='Social') return 'pkg-social';
  if(p==='SEO') return 'pkg-seo';
  return '';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FILTER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setFilter(f){
  activeFilter = f;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.toggle('active', b.dataset.f === f));
  renderTable();
}

function filteredRows(){
  const q = document.getElementById('searchInp').value.toLowerCase();
  const pkg = document.getElementById('filterPkg').value;
  const media = document.getElementById('filterMedia').value;
  const seo = document.getElementById('filterSeo').value;
  return rows.filter((r,i) => {
    if(q && !(r.name||'').toLowerCase().includes(q) && !(r.media||'').toLowerCase().includes(q) && !(r.seo||'').toLowerCase().includes(q)) return false;
    if(pkg && r.pkg !== pkg) return false;
    if(media && r.media !== media) return false;
    if(seo && r.seo !== seo) return false;
    if(activeFilter !== 'all' && r.status !== activeFilter) return false;
    return true;
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER TABLE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderTable(){
  const tbody = document.getElementById('mainBody');
  const data = filteredRows();
  if(!data.length){
    tbody.innerHTML = `<tr><td colspan="13" style="text-align:center;padding:30px;color:var(--muted);font-size:12px;">No records found</td></tr>`;
    return;
  }
  tbody.innerHTML = data.map((r,vi) => {
    const ri = rows.indexOf(r);
    const d = daysLeft(r.end);
    return `<tr class="${rowClass(r.status)}">
      <td style="color:var(--muted);font-size:10px;text-align:center">${ri+1}</td>
      <td><input class="t-inp" value="${r.name||''}" placeholder="Project name" style="min-width:140px" oninput="updateRow(${ri},'name',this.value)"/></td>
      <td><input type="date" class="t-date" value="${r.end||''}" onchange="updateRow(${ri},'end',this.value)"/></td>
      <td><span class="${daysClass(d)}">${daysText(d)}</span></td>
      <td><input type="checkbox" class="t-chk" ${r.meeting?'checked':''} onchange="updateRow(${ri},'meeting',this.checked)"/></td>
      <td>
        <select class="t-sel" onchange="updateRow(${ri},'status',this.value)" style="min-width:110px">
          ${STATUS_OPTS.map(o=>`<option value="${o}" ${r.status===o?'selected':''}>${o||'‚Äî'}</option>`).join('')}
        </select>
      </td>
      <td><input type="checkbox" class="t-chk upsell-chk" ${r.upsell?'checked':''} onchange="updateRow(${ri},'upsell',this.checked)"/></td>
      <td><input class="t-inp" value="${r.seo||''}" placeholder="SEO member" oninput="updateRow(${ri},'seo',this.value)"/></td>
      <td><input class="t-inp" value="${r.social||''}" placeholder="Social" oninput="updateRow(${ri},'social',this.value)"/></td>
      <td><input class="t-inp" value="${r.media||''}" placeholder="Media buyer" oninput="updateRow(${ri},'media',this.value)"/></td>
      <td><input class="t-inp" value="${r.acm||''}" placeholder="Acc. Manager" oninput="updateRow(${ri},'acm',this.value)"/></td>
      <td>
        <select class="t-sel" onchange="updateRow(${ri},'pkg',this.value)">
          ${PKG_OPTS.map(o=>`<option value="${o}" ${r.pkg===o?'selected':''}>${o||'‚Äî'}</option>`).join('')}
        </select>
      </td>
      <td><button class="t-rm" onclick="removeRow(${ri})">‚úï</button></td>
    </tr>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UPDATE / ADD / REMOVE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateRow(i, field, val){
  rows[i][field] = val;
  save();
  if(['status','meeting','upsell','pkg'].includes(field)) fullRender();
}

function removeRow(i){
  if(!confirm('Remove this client?')) return;
  rows.splice(i,1);
  fullRender();
  save();
}

function addRow(){
  const name = document.getElementById('f-name').value.trim();
  if(!name){ alert('Project name required'); return; }
  rows.push({
    name,
    end: document.getElementById('f-end').value,
    pkg: document.getElementById('f-pkg').value,
    status: document.getElementById('f-status').value,
    media: document.getElementById('f-media').value.trim(),
    seo: document.getElementById('f-seo').value.trim(),
    social: document.getElementById('f-social').value.trim(),
    acm: document.getElementById('f-acm').value.trim(),
    meeting: false,
    upsell: false
  });
  closeModal();
  fullRender();
  save();
  ['f-name','f-end','f-media','f-seo','f-social','f-acm'].forEach(id=>document.getElementById(id).value='');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderStats(){
  // Summary cards
  const total = rows.length;
  const done = rows.filter(r=>r.meeting).length;
  const newC = rows.filter(r=>(r.status||'').includes('ÿ¨ÿØÿØ')).length;
  const upsell = rows.filter(r=>r.upsell).length;
  const hold = rows.filter(r=>r.status==='ŸáŸàŸÑÿØ').length;
  const lost = rows.filter(r=>r.status==='ŸÅŸÇÿØ').length;

  document.getElementById('s-total').textContent = total;
  document.getElementById('s-done').textContent = done;
  document.getElementById('s-new').textContent = newC;
  document.getElementById('s-upsell').textContent = upsell;
  document.getElementById('s-hold').textContent = hold;
  document.getElementById('s-lost').textContent = lost;

  document.getElementById('ov-total').textContent = total;
  document.getElementById('ov-done').textContent = done;
  document.getElementById('ov-new').textContent = newC;
  document.getElementById('ov-upsell').textContent = upsell;
  document.getElementById('ov-hold').textContent = hold;
  document.getElementById('ov-lost').textContent = lost;

  // Package stats
  const pkgs = ['Full','Ads','Social','SEO'];
  const pkgColors = {'Full':'var(--done)','Ads':'var(--media)','Social':'var(--social)','SEO':'#6ee7b7'};
  document.getElementById('pkgStats').innerHTML = pkgs.map(p=>{
    const cnt = rows.filter(r=>r.pkg===p).length;
    return `<div style="text-align:center;padding:8px;background:var(--surface2);border-radius:8px;">
      <div style="font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px">${p}</div>
      <div style="font-family:'Syne',sans-serif;font-size:18px;font-weight:800;color:${pkgColors[p]}">${cnt}</div>
    </div>`;
  }).join('');

  // Media Buyers stats
  const mediaNames = [...new Set(rows.map(r=>r.media).filter(Boolean))].sort();
  const mbBody = document.getElementById('mbStatsBody');
  mbBody.innerHTML = mediaNames.map(name => {
    const myRows = rows.filter(r=>r.media===name);
    const clients = myRows.length;
    const target = Math.round(clients * 0.65);
    const renewal = myRows.filter(r=>r.status==='ÿ¨ÿØÿØ'||r.status==='ŸÖÿ¨ÿØÿØ').length;
    const remain = Math.max(0, target - renewal);
    const jadid = myRows.filter(r=>(r.status||'').includes('ÿ¨ÿØÿØ')).length;
    const mojadad = myRows.filter(r=>r.status==='ŸÖÿ¨ÿØÿØ').length;
    const faqad = myRows.filter(r=>r.status==='ŸÅŸÇÿØ').length;
    const pct = clients > 0 ? Math.round(renewal/clients*100) : 0;
    const ups = myRows.filter(r=>r.upsell).length;
    return `<tr>
      <td class="member-name">${name}</td>
      <td style="text-align:center;font-weight:700">${clients}</td>
      <td style="text-align:center;color:var(--muted)">${target}</td>
      <td style="text-align:center;color:var(--done)">${renewal}</td>
      <td style="text-align:center;color:${remain>0?'var(--hold)':'var(--done)'}">${remain}</td>
      <td style="text-align:center;color:var(--new)">${jadid}</td>
      <td style="text-align:center;color:var(--renewed)">${mojadad}</td>
      <td style="text-align:center;color:var(--lost)">${faqad}</td>
      <td>
        <div class="pct-bar">
          <div class="pct-fill" style="width:${pct}%;max-width:60px"></div>
          <span class="pct-txt">${pct}%</span>
        </div>
      </td>
      <td style="text-align:center;color:var(--copy)">${ups}</td>
    </tr>`;
  }).join('') || '<tr><td colspan="10" style="text-align:center;padding:16px;color:var(--muted);font-size:11px">No data</td></tr>';

  // SEO stats
  const seoNames = [...new Set(rows.map(r=>r.seo).filter(Boolean))].sort();
  const seoBody = document.getElementById('seoStatsBody');
  seoBody.innerHTML = seoNames.map(name => {
    const myRows = rows.filter(r=>r.seo===name);
    const clients = myRows.length;
    const target = Math.round(clients * 0.7);
    const renewal = myRows.filter(r=>r.status==='ÿ¨ÿØÿØ'||r.status==='ŸÖÿ¨ÿØÿØ').length;
    const pct = clients > 0 ? Math.round(renewal/clients*100) : 0;
    return `<tr>
      <td class="member-name">${name}</td>
      <td style="text-align:center;font-weight:700">${clients}</td>
      <td style="text-align:center;color:var(--muted)">${target}</td>
      <td style="text-align:center;color:var(--done)">${renewal}</td>
      <td>
        <div class="pct-bar">
          <div class="pct-fill" style="width:${pct}%;max-width:60px;background:var(--seo)"></div>
          <span class="pct-txt">${pct}%</span>
        </div>
      </td>
    </tr>`;
  }).join('') || '<tr><td colspan="5" style="text-align:center;padding:16px;color:var(--muted);font-size:11px">No data</td></tr>';

  // Update filter dropdowns
  const mediaSelect = document.getElementById('filterMedia');
  const seoSelect = document.getElementById('filterSeo');
  const curMedia = mediaSelect.value, curSeo = seoSelect.value;
  mediaSelect.innerHTML = `<option value="">All Media Buyers</option>` + mediaNames.map(n=>`<option value="${n}" ${n===curMedia?'selected':''}>${n}</option>`).join('');
  seoSelect.innerHTML = `<option value="">All SEO</option>` + seoNames.map(n=>`<option value="${n}" ${n===curSeo?'selected':''}>${n}</option>`).join('');

  // Update datalists
  document.getElementById('media-list').innerHTML = mediaNames.map(n=>`<option value="${n}">`).join('');
  document.getElementById('seo-list').innerHTML = seoNames.map(n=>`<option value="${n}">`).join('');
  const socialNames2 = [...new Set(rows.map(r=>r.social).filter(Boolean))].sort();
  const acmNames2 = [...new Set(rows.map(r=>r.acm).filter(Boolean))].sort();
  document.getElementById('social-list').innerHTML = socialNames2.map(n=>`<option value="${n}">`).join('');
  document.getElementById('acm-list').innerHTML = acmNames2.map(n=>`<option value="${n}">`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FULL RENDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function fullRender(){
  renderTable();
  renderStats();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SAVE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function save(){
  localStorage.setItem(KEY, JSON.stringify(rows));
  clearTimeout(saveTimer);
  const dot = document.getElementById('saveDot');
  dot.classList.add('show');
  saveTimer = setTimeout(()=>dot.classList.remove('show'), 1600);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openModal(){ document.getElementById('modal').classList.add('open'); document.getElementById('f-name').focus(); }
function closeModal(){ document.getElementById('modal').classList.remove('open'); }
document.getElementById('modal').addEventListener('click', e=>{ if(e.target===document.getElementById('modal')) closeModal(); });

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
fullRender();

</script>
</body>
</html>
